Fleet Management System - Complete Testing & Bug Fix Request
Overview
This is a fleet management system with two main interfaces:
Manager Dashboard - Fleet managers view vehicles, drivers, inspections, geofences, timesheets
Driver App - Drivers perform safety checks, clock in/out, view notifications
IMPORTANT: Cost Estimate Required First
Before making any changes, please provide:
Estimated time to complete all testing and fixes
Estimated token/credit cost
List of files that will be modified
Breakdown of major tasks
Wait for approval before proceeding.
Testing Requirements
Phase 1: Manager Dashboard Testing
1.1 Fleet Management (/manager/fleet)
 Test vehicle list displays correctly
 Test adding new vehicle
 Test editing vehicle details
 Test VOR (Vehicle Off Road) status toggle
 Test vehicle search and filtering
 Test MOT/Tax expiry warnings
 Verify service interval calculations
 Test vehicle deletion (soft delete)
1.2 Driver Management (/manager/drivers)
 Test driver list displays correctly
 Test adding new driver
 Test editing driver details
 Test driver status (active/inactive)
 Test driver search
 Verify driver role assignment
1.3 Geofences (/manager/geofences)
 Test creating circle geofence (with radius slider)
 Test creating polygon geofence (click to add vertices)
 Test "Undo Last Point" button for polygons
 Test "Clear All" button for polygons
 Verify geofences display on OpenStreetMap
 Test editing geofence (enable/disable)
 Test deleting geofence
 Verify color coding (green=active, gray=inactive)
1.4 Timesheets (/manager/timesheets)
 Test timesheet list displays correctly
 Test filtering by driver
 Test filtering by date range
 Test filtering by depot
 Verify total hours calculation
 Test wage calculation display
 Test manual timesheet entry
 Test timesheet export
1.5 Inspections (/manager/inspections)
 Test inspection list displays correctly
 Test filtering by vehicle/driver/date
 Test viewing inspection details
 Test defect tracking
 Verify PASS/FAIL status display
1.6 Documents (/manager/documents)
 Test document upload
 Test document categorization
 Test document expiry tracking
 Test document download
 Test document deletion
1.7 Pay Rates (/manager/pay-rates)
 Test viewing pay rates
 Test adding new pay rate
 Test editing pay rate
 Verify rate calculations (base, night, weekend, overtime)
Phase 2: Driver App Testing
2.1 Clock In/Out (/driver/clock-in-out)
 Test GPS location detection
 Test GPS accuracy display (color-coded: green/yellow/orange/red)
 Test blocking clock-in if accuracy >100m
 Test nearest depot detection
 Test circle geofence detection (within radius)
 Test polygon geofence detection (point-in-polygon)
 Test "At Depot" vs "Outside Range" status
 Test manual depot selection dropdown (when outside geofence)
 Test clock-in button (should be disabled until conditions met)
 Test clock-out functionality
 Verify timesheet creation in database
 Verify GPS accuracy stored in database
 Verify manual selection flag stored in database
2.2 Vehicle Inspection (/driver/inspection)
 Test vehicle selection
 Test trailer attachment toggle
 Test checklist items (pass/fail)
 Test defect reporting
 Test photo upload
 Test inspection submission
 Verify inspection timing (DVSA compliance)
 Test HGV vs LGV minimum check time
2.3 Fuel Entry (/driver/fuel)
 Test fuel entry form
 Test AdBlue entry
 Test receipt photo upload
 Test fuel card photo upload
 Verify odometer validation
2.4 Notifications (/driver/notifications)
 Test notification list display
 Test notification read/unread status
 Test notification filtering
Phase 3: Critical Logic Fixes
3.1 Geofencing Logic
Files to check:
shared/geofenceUtils.ts - Must exist with these functions:
calculateDistance(lat1, lon1, lat2, lon2) - Haversine formula
isPointInPolygon(point, polygon) - Ray-casting algorithm
isPointInCircle(point, center, radius) - Distance check
isPointInGeofence(point, geofence) - Unified function
client/src/pages/driver/ClockInOut.tsx - Must:
Import isPointInGeofence from @shared/geofenceUtils
Use navigator.geolocation.watchPosition with enableHighAccuracy: true
Display GPS accuracy with color coding
Block clock-in if accuracy >100m
Show manual depot selection if outside all geofences
Pass accuracy and manualSelection to API
server/storage.ts - Must:
Import isPointInGeofence from ../shared/geofenceUtils
Use polygon detection in checkGeofenceEntry()
Store arrivalAccuracy, departureAccuracy, manualDepotSelection
3.2 Database Schema Validation
Verify these fields exist:
geofences.geofence_type (varchar, default 'circle')
geofences.polygon_coordinates (jsonb, nullable)
timesheets.arrival_accuracy (integer, nullable)
timesheets.departure_accuracy (integer, nullable)
timesheets.manual_depot_selection (boolean, default false)
3.3 Authentication & Session
 Verify session.getCompany() works correctly
 Verify session.getUser() works correctly
 Test role-based access (ADMIN, TRANSPORT_MANAGER, DRIVER)
 Test driver PIN login
 Test manager password login
3.4 API Endpoints
Verify these endpoints work:
GET /api/geofences/:companyId - List geofences
POST /api/geofences - Create geofence (with polygon support)
PUT /api/geofences/:id - Update geofence
DELETE /api/geofences/:id - Delete geofence
POST /api/timesheets/clock-in - Clock in (with accuracy + manual selection)
POST /api/timesheets/clock-out - Clock out (with accuracy)
GET /api/timesheets/active/:driverId - Get active timesheet
Phase 4: UI/UX Fixes
4.1 Map Display
 Verify OpenStreetMap tiles load correctly
 Verify circle geofences render as circles
 Verify polygon geofences render as polygons
 Verify markers display correctly
 Test map zoom and pan
4.2 Responsive Design
 Test on mobile viewport (375px width)
 Test on tablet viewport (768px width)
 Test on desktop viewport (1920px width)
4.3 Loading States
 Add loading spinners where missing
 Add skeleton loaders for lists
 Add error states for failed API calls
4.4 Form Validation
 Test required field validation
 Test numeric field validation
 Test date field validation
 Test VRM format validation
Expected Deliverables
Test Report - Document all issues found
Fixed Code - All bugs resolved
Migration Script - If database changes needed
Documentation - Updated README with any new features
Known Issues to Fix
tsx caching issue - Clear any cached imports
Import path issues - Ensure @shared/ alias works
Missing geofenceUtils.ts - Create if doesn't exist
Hardcoded auth - Replace with session.getCompany() / session.getUser()
Nested anchor tags - Remove from VORWidget and other components
Success Criteria
✅ All manager dashboard pages load without errors

✅ All driver app pages load without errors

✅ Circle geofences work correctly

✅ Polygon geofences work correctly

✅ GPS accuracy validation works

✅ Manual depot selection works

✅ Timesheets are created automatically

✅ All API endpoints return correct data

✅ No console errors

✅ No TypeScript errors
Please provide cost estimate before proceeding.